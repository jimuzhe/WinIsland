<Window x:Class="WinIsland.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="topx" 
        Icon="ico.ico"
        Height="200" Width="800"
        WindowStyle="None" 
        AllowsTransparency="True" 
        Background="Transparent"
        Topmost="True"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        WindowStartupLocation="Manual"
        AllowDrop="True"
        Left="0"
        Top="0">

    <Grid>
        <Border x:Name="DynamicIsland"
                Width="120" Height="35"
                CornerRadius="0,0,10.5,10.5"
                Background="Black"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,0,0,0"
                MouseDown="DynamicIsland_MouseDown"
                MouseMove="DynamicIsland_MouseMove"
                MouseLeftButtonUp="DynamicIsland_MouseLeftButtonUp"
                MouseRightButtonUp="DynamicIsland_MouseRightButtonUp"
                MouseEnter="DynamicIsland_MouseEnter"
                MouseLeave="DynamicIsland_MouseLeave"
                AllowDrop="True"
                DragEnter="DynamicIsland_DragEnter"
                DragOver="DynamicIsland_DragOver"
                DragLeave="DynamicIsland_DragLeave"
                Drop="DynamicIsland_Drop">

            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="5" Opacity="0.5"/>
            </Border.Effect>

            <Grid>
                <Grid.Resources>
                    <Style x:Key="PlayerBtnStyle" TargetType="Button">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Margin" Value="5,0"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#00FFCC"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Resources>

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Row 0: Media controls & Info (Auto to support expansion) -->
                    <RowDefinition Height="Auto"/> <!-- Row 1: Lyrics -->
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/> <!-- 0: Album Cover -->
                    <ColumnDefinition Width="*"/>    <!-- 1: Main Content (Title, Preview, Controls, Full Lyric) -->
                    <ColumnDefinition Width="Auto"/> <!-- 2: Visualizer -->
                </Grid.ColumnDefinitions>

                <!-- 通知区域 -->
                <StackPanel x:Name="NotificationPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed">
                    <Grid Width="24" Height="24" Margin="0,0,12,0" RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <ScaleTransform x:Name="NotificationIconScale" ScaleX="1" ScaleY="1"/>
                        </Grid.RenderTransform>
                        <!-- 连接图标 (蓝牙/USB) -->
                        <Path x:Name="IconConnect" Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z" Fill="#00FFCC" Stretch="Uniform" Visibility="Collapsed">
                            <Path.Effect>
                                <DropShadowEffect Color="#00FFCC" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                            </Path.Effect>
                        </Path>
                        <!-- 断开图标 -->
                        <Path x:Name="IconDisconnect" Data="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M17,7H7C5.9,7 5,7.9 5,9V10H6V9H17V10H18V9C18,7.9 17.1,7 17,7M17,15H7C5.9,15 5,15.9 5,17V18H6V17H17V18H18V17C18,15.9 17.1,15 17,15M7,12H17V13H7V12Z" Fill="#FF3333" Stretch="Uniform" Visibility="Collapsed">
                            <Path.Effect>
                                <DropShadowEffect Color="#FF3333" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                            </Path.Effect>
                        </Path>
                        <!-- 消息图标 (微信/QQ) -->
                        <Path x:Name="IconMessage" Data="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18" Fill="#00BFFF" Stretch="Uniform" Visibility="Collapsed">
                            <Path.Effect>
                                <DropShadowEffect Color="#00BFFF" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                            </Path.Effect>
                        </Path>
                    </Grid>
                    <TextBlock x:Name="NotificationText" Text="Device Connected" Foreground="White" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="2" ShadowDepth="1" Opacity="0.5"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </StackPanel>

                <!-- 喝水提醒区域 -->
                <!-- 喝水提醒区域 (Premium Design) -->
                <Grid x:Name="DrinkWaterPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" VerticalAlignment="Center" HorizontalAlignment="Stretch" Visibility="Collapsed" Margin="15,0">
                    <Grid.RenderTransform>
                        <TranslateTransform Y="0"/>
                    </Grid.RenderTransform>
                    
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/> <!-- Icon -->
                        <ColumnDefinition Width="*"/>    <!-- Text -->
                        <ColumnDefinition Width="Auto"/> <!-- Button -->
                    </Grid.ColumnDefinitions>

                    <!-- 水滴图标 -->
                    <Grid Grid.Column="0" Width="36" Height="36" Margin="0,0,15,0" RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform x:Name="WaterIconScale" ScaleX="1" ScaleY="1"/>
                                <TranslateTransform x:Name="WaterIconTranslate" Y="0"/>
                            </TransformGroup>
                        </Grid.RenderTransform>
                        
                        <!-- 辉光背景 -->
                        <Ellipse Width="24" Height="24" HorizontalAlignment="Center" VerticalAlignment="Bottom" Opacity="0.4">
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="#00BFFF" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <BlurEffect Radius="10"/>
                            </Ellipse.Effect>
                        </Ellipse>

                        <Path Data="M12,22C16.4,22 20,18.4 20,14C20,10 12,2 12,2C12,2 4,10 4,14C4,18.4 7.6,22 12,22Z" Stretch="Uniform" Margin="2">
                            <Path.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#33CCFF" Offset="0"/>
                                    <GradientStop Color="#007ACC" Offset="1"/>
                                </LinearGradientBrush>
                            </Path.Fill>
                            <Path.Effect>
                                <DropShadowEffect Color="#00BFFF" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                            </Path.Effect>
                        </Path>
                    </Grid>

                    <!-- 文本信息 -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="该喝水了!" Foreground="White" FontSize="16" FontWeight="Bold"/>
                        <TextBlock Text="保持健康活力，补充水分" Foreground="#AAAAAA" FontSize="11" Margin="0,3,0,0"/>
                    </StackPanel>
                    
                    <!-- 确认按钮 -->
                    <Button Grid.Column="2" Click="BtnDrank_Click" Cursor="Hand" Width="64" Height="30" BorderThickness="0" Margin="10,0,0,0">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="BtnBorder" CornerRadius="15">
                                    <Border.Effect>
                                         <DropShadowEffect Color="#007ACC" BlurRadius="5" ShadowDepth="0" Opacity="0.3"/>
                                    </Border.Effect>
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#00BFFF" Offset="0"/>
                                            <GradientStop Color="#0066CC" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <TextBlock Text="已喝" Foreground="White" FontWeight="Bold" FontSize="13" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="BtnBorder" Property="Opacity" Value="0.9"/>
                                        <Setter TargetName="BtnBorder" Property="Background">
                                            <Setter.Value>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#33CCFF" Offset="0"/>
                                                    <GradientStop Color="#007ACC" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter TargetName="BtnBorder" Property="Opacity" Value="0.8"/>
                                        <Setter TargetName="BtnBorder" Property="RenderTransform">
                                            <Setter.Value>
                                                <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="32" CenterY="15"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>

                <!-- 待办事项提醒区域 -->
                <!-- 待办事项提醒区域 (Premium Design) -->
                <Grid x:Name="TodoPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" VerticalAlignment="Center" HorizontalAlignment="Stretch" Visibility="Collapsed" Margin="15,0">
                    <Grid.RenderTransform>
                        <TranslateTransform Y="0"/>
                    </Grid.RenderTransform>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 待办图标 -->
                    <Grid Grid.Column="0" Width="36" Height="36" Margin="0,0,15,0" RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <RotateTransform x:Name="TodoIconRotate" Angle="0"/>
                        </Grid.RenderTransform>
                        
                        <!-- 辉光 -->
                        <Ellipse Width="24" Height="24" HorizontalAlignment="Center" VerticalAlignment="Bottom" Opacity="0.4">
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="#FFA500" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <BlurEffect Radius="10"/>
                            </Ellipse.Effect>
                        </Ellipse>

                        <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z" Stretch="Uniform" Margin="2">
                            <Path.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#FFD700" Offset="0"/>
                                    <GradientStop Color="#FF8C00" Offset="1"/>
                                </LinearGradientBrush>
                            </Path.Fill>
                            <Path.Effect>
                                <DropShadowEffect Color="#FFA500" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                            </Path.Effect>
                        </Path>
                    </Grid>

                    <!-- 文本信息 -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="待办事项" Foreground="White" FontSize="16" FontWeight="Bold"/>
                        <TextBlock x:Name="TxtTodoMessage" Text="Check your tasks" Foreground="#AAAAAA" FontSize="11" Margin="0,3,0,0" TextTrimming="CharacterEllipsis"/>
                    </StackPanel>

                    <!-- 完成按钮 -->
                    <Button Grid.Column="2" Click="BtnTodoDone_Click" Cursor="Hand" Width="64" Height="30" BorderThickness="0" Margin="10,0,0,0">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="BtnBorder" CornerRadius="15">
                                    <Border.Effect>
                                         <DropShadowEffect Color="#30D158" BlurRadius="5" ShadowDepth="0" Opacity="0.3"/>
                                    </Border.Effect>
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#30D158" Offset="0"/>
                                            <GradientStop Color="#28A848" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <TextBlock Text="完成" Foreground="White" FontWeight="Bold" FontSize="13" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="BtnBorder" Property="Opacity" Value="0.9"/>
                                        <Setter TargetName="BtnBorder" Property="Background">
                                            <Setter.Value>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#32E060" Offset="0"/>
                                                    <GradientStop Color="#228C3C" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter TargetName="BtnBorder" Property="Opacity" Value="0.8"/>
                                        <Setter TargetName="BtnBorder" Property="RenderTransform">
                                             <Setter.Value>
                                                <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="32" CenterY="15"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>

                <!-- 灵动黑洞 (文件与中转站) -->
                <Grid x:Name="FileStationPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed" IsHitTestVisible="True">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 黑洞引力场背景 -->
                    <Grid Width="60" Height="60" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid.RenderTransform>
                            <ScaleTransform x:Name="BlackHoleScale" ScaleX="0" ScaleY="0" CenterX="30" CenterY="30"/>
                        </Grid.RenderTransform>
                         <!-- 外围吸积盘辉光 -->
                        <Ellipse Width="60" Height="60">
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="#4C00FFFF" Offset="0.5"/>
                                    <GradientStop Color="#00000000" Offset="1"/>
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <BlurEffect Radius="10"/>
                            </Ellipse.Effect>
                        </Ellipse>
                        
                        <!-- 视界 (事件视界) -->
                        <Ellipse Width="40" Height="40" Fill="Black">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#8A2BE2" BlurRadius="15" ShadowDepth="0" Opacity="0.8"/>
                            </Ellipse.Effect>
                        </Ellipse>
                        
                        <!-- 内部漩涡 -->
                        <Path Data="M30,10 A20,20 0 1 1 10,30" Stroke="#8A2BE2" StrokeThickness="2" Opacity="0.8">
                            <Path.RenderTransform>
                                <RotateTransform x:Name="VortexRotation" Angle="0" CenterX="30" CenterY="30"/>
                            </Path.RenderTransform>
                        </Path>
                    </Grid>

                    <!-- 文件堆栈显示 (存储状态) -->
                    <Grid x:Name="FileStackDisplay" Visibility="Collapsed" MouseLeftButtonDown="FileStack_MouseDown">
                        <Grid.ToolTip>
                            <ToolTip Content="File Station: Drag out to retrieve files"/>
                        </Grid.ToolTip>
                        
                        <!-- 文件背景层 (模拟堆叠) -->
                        <Border Width="24" Height="30" Background="#33FFFFFF" CornerRadius="4" Margin="4,0,0,4" RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <RotateTransform Angle="10"/>
                            </Border.RenderTransform>
                        </Border>
                        
                        <!-- 主文件图标 -->
                        <Border Width="24" Height="30" Background="White" CornerRadius="4" BorderBrush="#8A2BE2" BorderThickness="1">
                             <Path Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" Fill="#8A2BE2" Stretch="Uniform" Margin="4"/>
                        </Border>
                        
                        <!-- 文件数量角标 -->
                        <Border Background="Red" CornerRadius="7" Width="14" Height="14" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-5,-5,0">
                            <TextBlock x:Name="FileCountText" Text="1" Foreground="White" FontSize="9" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                        </Border>
                    </Grid>

                    <!-- 拖拽提示文字 -->
                    <TextBlock x:Name="DropHintText" Text="Drop to Store" Foreground="White" FontSize="12" FontWeight="SemiBold" Margin="0,40,0,0" Opacity="0" HorizontalAlignment="Center"/>
                    
                </Grid>



                <!-- 左侧封面卡片 -->
                <Image x:Name="AlbumCover" Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Width="40" Height="40" Margin="10,4,0,0" VerticalAlignment="Top" Visibility="Collapsed" Stretch="UniformToFill">
                    <Image.Clip>
                        <RectangleGeometry x:Name="AlbumClip" Rect="0,0,40,40" RadiusX="10" RadiusY="10"/>
                    </Image.Clip>
                </Image>
                <Border x:Name="AudioSourceBadge"
                        Grid.Row="0"
                        Grid.RowSpan="2"
                        Grid.Column="0"
                        Width="18"
                        Height="18"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        BorderThickness="0"
                        Margin="34,28,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Visibility="Collapsed"
                        IsHitTestVisible="False">
                    <Grid>
                        <Grid.Effect>
                            <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.8" Color="Black"/>
                        </Grid.Effect>
                        <Image x:Name="AudioSourceBadgeIcon"
                               Width="14"
                               Height="14"
                               Stretch="Uniform"
                               Visibility="Collapsed"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                        <TextBlock x:Name="AudioSourceBadgeText"
                                   Text="♪"
                                   Foreground="White"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 右侧信息与控制区 -->
                <StackPanel x:Name="MainMediaArea" Grid.Row="0" Grid.Column="1" VerticalAlignment="Top" Margin="12,4,14,0" MaxHeight="40">
                    <!-- 1. 歌曲信息 (紧凑/展开) -->
                    <StackPanel x:Name="InfoPanel" HorizontalAlignment="Left" VerticalAlignment="Center">
                        <TextBlock x:Name="SongTitle" Text="topx" Foreground="White" FontSize="14" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                        <TextBlock x:Name="ArtistName" Text="Unknown Artist" Foreground="#AAAAAA" FontSize="11" Margin="0,1,0,0" Visibility="Collapsed" Opacity="0"/>
                        <TextBlock x:Name="SongLyricPreview" Text="" Foreground="#E6E6E6" FontSize="13" Margin="0,0,0,0" TextWrapping="Wrap" MaxHeight="40" TextTrimming="CharacterEllipsis" Visibility="Collapsed"/>
                    </StackPanel>

                    <Grid x:Name="ProgressArea" Margin="0,5,0,1" Visibility="Collapsed" Opacity="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Slider x:Name="MediaProgressBar" Height="12" Background="Transparent" Foreground="White" BorderThickness="0" Maximum="100" Value="0" VerticalAlignment="Center" MouseLeftButtonUp="MediaProgressBar_MouseLeftButtonUp" IsMoveToPointEnabled="True">
                            <Slider.Template>
                                <ControlTemplate TargetType="Slider">
                                    <Grid VerticalAlignment="Center">
                                        <Border Height="4" Background="#33FFFFFF" CornerRadius="2"/>
                                        <Track x:Name="PART_Track">
                                            <Track.DecreaseRepeatButton>
                                                <RepeatButton Command="Slider.DecreaseLarge">
                                                    <RepeatButton.Template>
                                                        <ControlTemplate>
                                                            <Border Height="4" Background="White" CornerRadius="2"/>
                                                        </ControlTemplate>
                                                    </RepeatButton.Template>
                                                </RepeatButton>
                                            </Track.DecreaseRepeatButton>
                                            <Track.Thumb>
                                                <Thumb Width="8" Height="8">
                                                    <Thumb.Template>
                                                        <ControlTemplate>
                                                            <Ellipse Fill="White" Width="6" Height="6" x:Name="ThumbEllipse">
                                                                <Ellipse.Effect>
                                                                    <DropShadowEffect BlurRadius="4" ShadowDepth="0" Opacity="0.5"/>
                                                                </Ellipse.Effect>
                                                            </Ellipse>
                                                        </ControlTemplate>
                                                    </Thumb.Template>
                                                </Thumb>
                                            </Track.Thumb>
                                        </Track>
                                    </Grid>
                                </ControlTemplate>
                            </Slider.Template>
                        </Slider>
                        <Grid Grid.Row="1" Margin="0,4,0,0">
                            <TextBlock x:Name="TxtCurrentTime" Text="0:00" Foreground="#88FFFFFF" FontSize="10" HorizontalAlignment="Left"/>
                            <TextBlock x:Name="TxtTotalTime" Text="0:00" Foreground="#88FFFFFF" FontSize="10" HorizontalAlignment="Right"/>
                        </Grid>
                    </Grid>
                    <!-- 3. 控制按钮 (悬停时变大并居中) -->
                    <StackPanel x:Name="ControlPanel" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,4,0,0" Visibility="Collapsed" Opacity="0">
                        <Button x:Name="BtnPrev" Click="BtnPrev_Click" Style="{StaticResource PlayerBtnStyle}" Width="24" Height="24" Margin="4,0">
                            <Path Data="M18,6 L18,18 L16,18 L16,6 L18,6 Z M15,12 L7,18 L7,6 L15,12 Z M8,12 L0,18 L0,6 L8,12 Z" Fill="White" Stretch="Uniform" Width="16" Height="14"/>
                        </Button>
                        <Button x:Name="BtnPlayPause" Click="BtnPlayPause_Click" Style="{StaticResource PlayerBtnStyle}" Width="28" Height="28" Margin="4,0">
                            <Grid>
                                <Path x:Name="IconPlay" Data="M8,5 L19,12 L8,19 Z" Fill="White" Stretch="Uniform" Width="14" Height="14" Visibility="Visible"/>
                                <Path x:Name="IconPause" Data="M6,19 L10,19 L10,5 L6,5 Z M14,5 L14,19 L18,19 L18,5 Z" Fill="White" Stretch="Uniform" Width="13" Height="13" Visibility="Collapsed"/>
                            </Grid>
                        </Button>
                        <Button x:Name="BtnNext" Click="BtnNext_Click" Style="{StaticResource PlayerBtnStyle}" Width="24" Height="24" Margin="4,0">
                            <Path Data="M0,6 L0,18 L2,18 L2,6 L0,6 Z M3,12 L11,6 L11,18 L3,12 Z M10,12 L18,6 L18,18 L10,12 Z" Fill="White" Stretch="Uniform" Width="16" Height="14"/>
                        </Button>
                    </StackPanel>
                </StackPanel>
                
                <!-- 展开模式下的独立歌词行 (可选位置) -->
                <TextBlock x:Name="SongLyricFull" Grid.Row="1" Grid.Column="1" Text="" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,10" TextWrapping="Wrap" TextAlignment="Left" Visibility="Collapsed" Opacity="0"/>

                <!-- 频谱 (限制高度并开启裁剪，隔离布局影响) -->
                <Grid x:Name="VisualizerContainer" Grid.Row="0" Grid.Column="2" VerticalAlignment="Top" Visibility="Collapsed" Height="24" Margin="0,12,15,0" ClipToBounds="True">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- ...保持不变... -->
                    <StackPanel.Resources>
                        <LinearGradientBrush x:Key="VisualizerBrush1" StartPoint="0,1" EndPoint="0,0">
                            <GradientStop Color="#32D74B" Offset="0"/> <!-- Lime Green -->
                            <GradientStop Color="#007AFF" Offset="1"/> <!-- Blue -->
                        </LinearGradientBrush>
                        <LinearGradientBrush x:Key="VisualizerBrush2" StartPoint="0,1" EndPoint="0,0">
                            <GradientStop Color="#30D158" Offset="0"/> <!-- Emerald Green -->
                            <GradientStop Color="#00C7FF" Offset="1"/> <!-- Bright Blue -->
                        </LinearGradientBrush>
                        <LinearGradientBrush x:Key="VisualizerBrush3" StartPoint="0,1" EndPoint="0,0">
                            <GradientStop Color="#00FFCC" Offset="0"/> <!-- Teal/Green -->
                            <GradientStop Color="#0040FF" Offset="1"/> <!-- Deep Blue -->
                        </LinearGradientBrush>
                        <LinearGradientBrush x:Key="VisualizerBrush4" StartPoint="0,1" EndPoint="0,0">
                            <GradientStop Color="#34C759" Offset="0"/> <!-- Green -->
                            <GradientStop Color="#5AC8FA" Offset="1"/> <!-- Azure Blue -->
                        </LinearGradientBrush>
                        <LinearGradientBrush x:Key="VisualizerBrush5" StartPoint="0,1" EndPoint="0,0">
                            <GradientStop Color="#00FFAA" Offset="0"/> <!-- Spring Green -->
                            <GradientStop Color="#1D62F0" Offset="1"/> <!-- Ocean Blue -->
                        </LinearGradientBrush>
                    </StackPanel.Resources>
                    <Border x:Name="Bar1" Width="3" Height="4" Background="{StaticResource VisualizerBrush1}" Margin="1" CornerRadius="1.5"/>
                    <Border x:Name="Bar2" Width="3" Height="8" Background="{StaticResource VisualizerBrush2}" Margin="1" CornerRadius="1.5"/>
                    <Border x:Name="Bar3" Width="3" Height="12" Background="{StaticResource VisualizerBrush3}" Margin="1" CornerRadius="1.5"/>
                    <Border x:Name="Bar4" Width="3" Height="8" Background="{StaticResource VisualizerBrush4}" Margin="1" CornerRadius="1.5"/>
                    <Border x:Name="Bar5" Width="3" Height="4" Background="{StaticResource VisualizerBrush5}" Margin="1" CornerRadius="1.5"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
