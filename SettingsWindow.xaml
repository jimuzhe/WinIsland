<Window x:Class="TopX.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="topx 设置"
        Icon="ico.ico"
        Height="610" Width="910"
        MinHeight="520" MinWidth="820"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True"
        FontFamily="Bahnschrift"
        FontSize="13"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        MouseDown="Window_MouseDown">

    <Window.Resources>
        <!-- Palette (Dark Mode / Dynamic Island Style) -->
        <Color x:Key="WindowBgTop">#1E1E1E</Color>
        <Color x:Key="WindowBgBottom">#121212</Color>
        
        <Color x:Key="NavBgTop">#252525</Color>
        <Color x:Key="NavBgBottom">#1E1E1E</Color>

        <Color x:Key="Card">#2D2D2D</Color>
        <Color x:Key="CardAlt">#383838</Color>
        <Color x:Key="Stroke">#444444</Color>
        
        <!-- TopX Accents -->
        <Color x:Key="Accent">#00FFCC</Color> <!-- Teal/Cyan -->
        <Color x:Key="AccentDark">#00CC99</Color>
        <Color x:Key="Warm">#FFB347</Color>
        
        <Color x:Key="TextMain">#FFFFFF</Color>
        <Color x:Key="TextSub">#AAAAAA</Color>
        <Color x:Key="NavText">#DDDDDD</Color>
        <Color x:Key="NavSub">#999999</Color>

        <LinearGradientBrush x:Key="WindowBgBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="{StaticResource WindowBgTop}" Offset="0"/>
            <GradientStop Color="{StaticResource WindowBgBottom}" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="NavBgBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="{StaticResource NavBgTop}" Offset="0"/>
            <GradientStop Color="{StaticResource NavBgBottom}" Offset="1"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="CardBgBrush" Color="{StaticResource Card}"/>
        <SolidColorBrush x:Key="CardAltBrush" Color="{StaticResource CardAlt}"/>
        <SolidColorBrush x:Key="StrokeBrush" Color="{StaticResource Stroke}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource Accent}"/>
        <SolidColorBrush x:Key="AccentDarkBrush" Color="{StaticResource AccentDark}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextMain}"/>
        <SolidColorBrush x:Key="SecondaryTextBrush" Color="{StaticResource TextSub}"/>
        <SolidColorBrush x:Key="NavTextBrush" Color="{StaticResource NavText}"/>
        <SolidColorBrush x:Key="NavSubBrush" Color="{StaticResource NavSub}"/>

        <RadialGradientBrush x:Key="AccentGlowBrush" RadiusX="0.9" RadiusY="0.9">
            <GradientStop Color="#3300FFCC" Offset="0"/>
            <GradientStop Color="#0000FFCC" Offset="1"/>
        </RadialGradientBrush>

        <RadialGradientBrush x:Key="WarmGlowBrush" RadiusX="0.9" RadiusY="0.9">
            <GradientStop Color="#33FFB347" Offset="0"/>
            <GradientStop Color="#00FFB347" Offset="1"/>
        </RadialGradientBrush>

        <!-- Typography -->
        <Style x:Key="TitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="26"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="CaptionStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- ScrollBar Style -->
        <Style TargetType="ScrollBar">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="Bg" Background="Transparent" SnapsToDevicePixels="true">
                            <Track x:Name="PART_Track" IsDirectionReversed="true" IsEnabled="{TemplateBinding IsMouseOver}">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#44FFFFFF" CornerRadius="4" Margin="2,0"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter TargetName="PART_Track" Property="Width" Value="8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Navigation -->
        <Style x:Key="NavItemStyle" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{StaticResource NavTextBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="NavBorder" Background="Transparent" CornerRadius="8" Padding="10,8">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="NavBorder" Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="NavBorder" Property="Background" Value="#22FFFFFF"/>
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Buttons -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource CardAltBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="BtnBorder" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="#444444"/>
                                <Setter TargetName="BtnBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="#222222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBox -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="CaretBrush" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle CheckBox -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Margin="0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ContentPresenter Grid.Column="0" VerticalAlignment="Center"/>
                            <Border x:Name="Track" Grid.Column="1" Width="44" Height="22" CornerRadius="11" Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1">
                                <Ellipse x:Name="Thumb" Width="18" Height="18" Fill="#8E98A7" HorizontalAlignment="Left" Margin="2,0,0,0"/>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Track" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="Track" Property="BorderBrush" Value="{StaticResource AccentDarkBrush}"/>
                                <Setter TargetName="Thumb" Property="HorizontalAlignment" Value="Right"/>
                                <Setter TargetName="Thumb" Property="Fill" Value="White"/>
                                <Setter TargetName="Thumb" Property="Margin" Value="0,0,2,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DatePicker Styling -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="SelectionBrush" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePickerTextBox">
                        <TextBox x:Name="PART_TextBox" Text="{Binding Path=SelectedDate, StringFormat='yyyy/MM/dd', RelativeSource={RelativeSource AncestorType={x:Type DatePicker}}}" Background="{TemplateBinding Background}" Foreground="{TemplateBinding Foreground}" BorderThickness="0" Padding="5,2" VerticalAlignment="Center" IsReadOnly="True" Cursor="Hand"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="{StaticResource StrokeBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <Grid Background="Transparent">
        <!-- This border provides the main background, rounded corners and shadow -->
        <Border Background="{StaticResource WindowBgBrush}" 
                BorderBrush="{StaticResource StrokeBrush}" 
                BorderThickness="1" 
                CornerRadius="16" 
                Margin="25">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="30" ShadowDepth="0" Opacity="0.6"/>
            </Border.Effect>

            <Grid>
                <!-- Decorative glows (Clipped to rounded corners of the window) -->
                <Grid IsHitTestVisible="False">
                    <Grid.Clip>
                        <RectangleGeometry RadiusX="16" RadiusY="16" Rect="0,0,860,560"/>
                    </Grid.Clip>
                    <Ellipse Fill="{StaticResource AccentGlowBrush}" Width="420" Height="420" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-180,-200,0,0"/>
                    <Ellipse Fill="{StaticResource WarmGlowBrush}" Width="360" Height="360" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-120,-160,0"/>
                </Grid>

                <!-- UI Content area with original padding -->
                <Grid Margin="18">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock Text="topx" Style="{StaticResource TitleTextStyle}"/>
                        <TextBlock Text="设置中心 · 更改自动保存" Style="{StaticResource CaptionStyle}" Margin="0,4,0,0"/>
                    </StackPanel>
                    <Button Grid.Column="1" Content="✕" Click="Cancel_Click" Background="Transparent" BorderThickness="0" Foreground="{StaticResource SecondaryTextBrush}" FontSize="16" Padding="6" VerticalAlignment="Top"/>
                </Grid>

                <!-- Content -->
                <Grid Grid.Row="1" Margin="0,16,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="190"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Navigation -->
                    <Border Grid.Column="0" Background="{StaticResource NavBgBrush}" CornerRadius="12" Padding="12">
                        <StackPanel>
                            <TextBlock Text="SECTIONS" Foreground="{StaticResource NavSubBrush}" FontSize="11" Margin="6,0,0,10"/>
                            <RadioButton x:Name="NavNotify" Content="通知" GroupName="NavGroup" IsChecked="True" Checked="Nav_Checked" Tag="PanelNotify" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavMedia" Content="媒体" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelMedia" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavAppearance" Content="外观" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelAppearance" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavSystem" Content="系统" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelSystem" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavHealth" Content="健康" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelHealth" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavTodo" Content="待办" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelTodo" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavFocus" Content="专注" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelFocus" Style="{StaticResource NavItemStyle}"/>
                            <RadioButton x:Name="NavAi" Content="AI 助手" GroupName="NavGroup" Checked="Nav_Checked" Tag="PanelAi" Style="{StaticResource NavItemStyle}"/>
                        </StackPanel>
                    </Border>

                    <!-- Pages -->
                    <Border Grid.Column="1" Background="{StaticResource CardBgBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="12" Padding="16" Margin="16,0,0,0">
                        <Grid>
                            <!-- 专注模式 -->
                            <ScrollViewer x:Name="PanelFocus" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="专注模式" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock Text="双击灵动岛进入专注状态。在此状态下，非允许的应用通知将被过滤。" Style="{StaticResource CaptionStyle}" Margin="0,0,0,12" TextWrapping="Wrap"/>
                                    
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12" Margin="0,0,0,12">
                                        <StackPanel>
                                            <TextBlock Text="专注统计 (最近 7 天)" Style="{StaticResource SectionHeaderStyle}"/>
                                            
                                            <!-- 新增统计数据概览 -->
                                            <Grid Margin="0,0,0,15">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="历史总专注" Style="{StaticResource CaptionStyle}"/>
                                                    <TextBlock x:Name="TxtTotalFocusTime" Text="0小时 0分" FontSize="18" FontWeight="Bold" Foreground="White" Margin="0,2,0,0"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="今日最活跃段" Style="{StaticResource CaptionStyle}"/>
                                                    <TextBlock x:Name="TxtActivePeriod" Text="暂无数据" FontSize="18" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>

                                            <Grid Height="130" Margin="0,10,0,5">
                                                <ItemsControl x:Name="ChartFocusHistory" HorizontalAlignment="Stretch">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Columns="7" VerticalAlignment="Bottom"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <StackPanel VerticalAlignment="Bottom" Margin="0" HorizontalAlignment="Center">
                                                                <Border Background="{StaticResource AccentBrush}" Width="20" CornerRadius="4,4,1,1" Height="{Binding BarHeight}" Opacity="0.8">
                                                                    <Border.Effect>
                                                                        <DropShadowEffect Color="{StaticResource Accent}" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
                                                                    </Border.Effect>
                                                                    <Border.ToolTip>
                                                                        <ToolTip Content="{Binding ToolTipText}"/>
                                                                    </Border.ToolTip>
                                                                </Border>
                                                                <TextBlock Text="{Binding DayLabel}" Foreground="{StaticResource SecondaryTextBrush}" FontSize="10" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12" Margin="0,0,0,12">
                                        <StackPanel>
                                            <TextBlock Text="自动开启专注" Style="{StaticResource SectionHeaderStyle}"/>
                                            <CheckBox x:Name="ChkAutoFocusEnabled" Content="启用自动专注" FontWeight="SemiBold" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <TextBlock Text="当以下进程处于活动窗口时，自动进入专注模式；离开时自动暂停。" Style="{StaticResource CaptionStyle}" Margin="0,4,0,8" TextWrapping="Wrap"/>
                                            <TextBox x:Name="TxtAutoFocusApps" Height="40" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" LostFocus="AutoSave_LostFocus" Margin="0,0,0,4"/>
                                            <TextBlock Text="进程名(不含.exe)，多个用逗号分隔。如: devenv, Code, Photoshop" FontSize="11" Foreground="#666666"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <TextBlock Text="专注期间通知控制 (过滤逻辑)" Style="{StaticResource CaptionStyle}" Margin="0,0,0,8"/>
                                            <CheckBox x:Name="ChkFocusModeBluetooth" Content="允许蓝牙设备通知" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeUsb" Content="允许 USB 设备通知" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeMessage" Content="允许微信 / QQ 消息" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeAllowAllApps" Content="允许所有其他应用通知" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            
                                            <Border BorderBrush="{StaticResource StrokeBrush}" BorderThickness="0,1,0,0" Margin="0,10,0,10"/>
                                            
                                            <TextBlock Text="专注期间允许的通知关键字 (白名单, 逗号分隔)" Foreground="{StaticResource SecondaryTextBrush}" FontSize="12" Margin="0,0,0,8"/>
                                            <TextBox x:Name="TxtFocusModeAllowedApps" Height="60" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" LostFocus="AutoSave_LostFocus" Margin="0,0,5,0"/>
                                            <TextBlock Text="例如: 钉钉, 企业微信, 电话" FontSize="11" Foreground="#666666" Margin="0,4,0,12"/>
                                            <Border BorderBrush="{StaticResource StrokeBrush}" BorderThickness="0,1,0,0" Margin="0,0,0,10"/>
                                            <TextBlock Text="专注期间显示的交互项" Style="{StaticResource CaptionStyle}" Margin="0,0,0,8"/>
                                            <CheckBox x:Name="ChkFocusModeShowMediaPlayer" Content="显示媒体播放器" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeShowVisualizer" Content="显示音频可视化" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeShowSystemStats" Content="显示系统参数 (CPU/RAM)" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeShowDrinkWater" Content="显示喝水提醒" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeShowSedentary" Content="显示久坐提醒" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeShowTodo" Content="显示待办提醒" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkFocusModeAi" Content="显示 AI 陪伴消息" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- AI 助手 -->
                            <ScrollViewer x:Name="PanelAi" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="AI 陪伴助手" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock Text="让 AI 感知你当前使用的应用，在灵动岛上给予温柔陪伴。" Style="{StaticResource CaptionStyle}" Margin="0,0,0,12" TextWrapping="Wrap"/>

                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkAiEnabled" Content="开启 AI 陪伴" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed" Margin="0,0,0,10"/>
                                            
                                            <TextBlock Text="API Key" Style="{StaticResource CaptionStyle}" Margin="0,5,0,5"/>
                                            <TextBox x:Name="TxtAiApiKey" Margin="0,0,0,10" LostFocus="AutoSave_LostFocus"/>

                                            <TextBlock Text="API 端点 (Base URL)" Style="{StaticResource CaptionStyle}" Margin="0,5,0,5"/>
                                            <TextBox x:Name="TxtAiEndpoint" Margin="0,0,0,10" LostFocus="AutoSave_LostFocus"/>

                                            <TextBlock Text="模型名称" Style="{StaticResource CaptionStyle}" Margin="0,5,0,5"/>
                                            <TextBox x:Name="TxtAiModel" Margin="0,0,0,10" LostFocus="AutoSave_LostFocus"/>

                                            <TextBlock Text="系统提示词 (Prompt)" Style="{StaticResource CaptionStyle}" Margin="0,5,0,5"/>
                                            <TextBox x:Name="TxtAiSystemPrompt" Height="80" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" LostFocus="AutoSave_LostFocus"/>
                                            <TextBlock Text="可用变量: {AppName} 表示当前应用名" FontSize="11" Foreground="#666666" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>


                            <!-- 通知 -->
                            <ScrollViewer x:Name="PanelNotify" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="通知" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkBluetoothNotification" Content="蓝牙设备" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkUsbNotification" Content="USB 设备" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkMessageNotification" Content="微信 / QQ 消息" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkNotificationAllowAllApps" Content="允许所有应用通知" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <TextBlock x:Name="TxtWhitelistLabel" Text="通知应用白名单（逗号/换行分隔）" Style="{StaticResource CaptionStyle}" Margin="0,8,0,4"/>
                                            <TextBox x:Name="TxtNotificationWhitelist" MinWidth="300" MinHeight="64" AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" LostFocus="AutoSave_LostFocus"/>
                                            <CheckBox x:Name="ChkNotificationDebugLogging" Content="通知调试日志（记录全部来源）" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <Button Content="发送测试通知" Click="BtnTestNotification_Click" Margin="0,10,0,0" HorizontalAlignment="Left"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- 媒体 -->
                            <ScrollViewer x:Name="PanelMedia" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="媒体" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkShowMediaPlayer" Content="显示媒体播放器" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkShowVisualizer" Content="显示音频可视化" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- 外观 -->
                            <ScrollViewer x:Name="PanelAppearance" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="外观" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <TextBlock Text="灵动岛透明度" Style="{StaticResource CaptionStyle}" Margin="0,0,0,6"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Slider x:Name="SldIslandOpacity" Minimum="0.2" Maximum="1" Value="1" TickFrequency="0.05" IsSnapToTickEnabled="True" ValueChanged="SldIslandOpacity_ValueChanged"/>
                                                <TextBlock x:Name="TxtIslandOpacityValue" Grid.Column="1" Text="100%" Foreground="{StaticResource TextBrush}" Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                                            </Grid>

                                            <TextBlock Text="灵动岛宽度 (待机)" Style="{StaticResource CaptionStyle}" Margin="0,12,0,6"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Slider x:Name="SldIslandWidth" Minimum="80" Maximum="200" Value="120" TickFrequency="5" IsSnapToTickEnabled="True" ValueChanged="SldIslandWidth_ValueChanged"/>
                                                <TextBlock x:Name="TxtIslandWidthValue" Grid.Column="1" Text="120" Foreground="{StaticResource TextBrush}" Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                                            </Grid>

                                            <TextBlock Text="灵动岛高度 (待机)" Style="{StaticResource CaptionStyle}" Margin="0,12,0,6"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Slider x:Name="SldIslandHeight" Minimum="25" Maximum="50" Value="35" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="SldIslandHeight_ValueChanged"/>
                                                <TextBlock x:Name="TxtIslandHeightValue" Grid.Column="1" Text="35" Foreground="{StaticResource TextBrush}" Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- 系统 -->
                            <ScrollViewer x:Name="PanelSystem" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="系统" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkStartWithWindows" Content="开机自启动" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                            <CheckBox x:Name="ChkSystemStats" Content="待机时显示系统参数 (CPU/RAM)" Checked="AutoSave_Changed" Unchecked="AutoSave_Changed"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- 健康 -->
                            <ScrollViewer x:Name="PanelHealth" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="健康与专注" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkDrinkWater" Content="喝水提醒" Checked="ChkDrinkWater_Checked" Unchecked="ChkDrinkWater_Unchecked"/>
                                            <StackPanel x:Name="PanelDrinkWaterSettings" Margin="0,8,0,0" Visibility="Collapsed">
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                    <RadioButton x:Name="RbModeInterval" Content="间隔提醒" GroupName="DrinkMode" IsChecked="True" Foreground="{StaticResource TextBrush}" Margin="0,0,20,0" Checked="RbMode_Checked"/>
                                                    <RadioButton x:Name="RbModeCustom" Content="自定义时间" GroupName="DrinkMode" Foreground="{StaticResource TextBrush}" Checked="RbMode_Checked"/>
                                                </StackPanel>

                                                <Grid x:Name="PanelModeInterval">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                        <TextBlock Text="间隔 (分钟)" Style="{StaticResource CaptionStyle}" Margin="0,0,0,5"/>
                                                        <TextBox x:Name="TxtDrinkWaterInterval" Text="30" FontFamily="Cascadia Mono" LostFocus="AutoSave_LostFocus"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="1" Width="180">
                                                        <TextBlock Text="活动时间段" Style="{StaticResource CaptionStyle}" Margin="0,0,0,5"/>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Grid.Column="0" x:Name="TxtDrinkStartTime" Text="09:00" FontFamily="Cascadia Mono" MaxLength="5" LostFocus="AutoSave_LostFocus"/>
                                                            <TextBlock Grid.Column="1" Text="-" Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="5,0"/>
                                                            <TextBox Grid.Column="2" x:Name="TxtDrinkEndTime" Text="22:00" FontFamily="Cascadia Mono" MaxLength="5" LostFocus="AutoSave_LostFocus"/>
                                                        </Grid>
                                                    </StackPanel>
                                                </Grid>

                                                <StackPanel x:Name="PanelModeCustom" Visibility="Collapsed">
                                                    <Grid Margin="0,0,0,10">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBox x:Name="TxtCustomDrinkTime" Tag="HH:MM" MaxLength="5" FontFamily="Cascadia Mono" Margin="0,0,10,0"/>
                                                        <Button Grid.Column="1" Content="添加时间" Click="BtnAddCustomDrinkTime_Click"/>
                                                    </Grid>
                                                    <ItemsControl x:Name="ListCustomDrinkTimes">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="6" Margin="0,0,0,6" Padding="10,6">
                                                                    <Grid>
                                                                        <TextBlock Text="{Binding}" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                                                                        <Button Content="×" HorizontalAlignment="Right" Click="BtnDeleteCustomDrinkTime_Click" Tag="{Binding}" Background="Transparent" BorderThickness="0" Foreground="#D9534F" Padding="5,0"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- 久坐提醒 -->
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12" Margin="0,12,0,0">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkSedentaryReminder" Content="久坐提醒" Checked="ChkSedentary_Checked" Unchecked="ChkSedentary_Unchecked"/>
                                            <StackPanel x:Name="PanelSedentarySettings" Margin="0,8,0,0" Visibility="Collapsed">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="提醒间隔 (分钟)" Style="{StaticResource CaptionStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                    <TextBox x:Name="TxtSedentaryInterval" Text="60" Width="60" FontFamily="Cascadia Mono" LostFocus="AutoSave_LostFocus"/>
                                                </StackPanel>
                                                <TextBlock Text="* 当检测到系统空闲不足设定时间（即一直在操作）持续达到该时长时提醒休息" Style="{StaticResource CaptionStyle}" Margin="0,6,0,0" Opacity="0.7" TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                </StackPanel>
                            </ScrollViewer>

                            <!-- 待办 -->
                            <ScrollViewer x:Name="PanelTodo" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel>
                                    <TextBlock Text="待办事项" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="10" Padding="12">
                                        <StackPanel>
                                            <CheckBox x:Name="ChkTodo" Content="待办事项提醒" Checked="ChkTodo_Checked" Unchecked="ChkTodo_Unchecked"/>
                                            <StackPanel x:Name="PanelTodoSettings" Margin="0,8,0,0" Visibility="Collapsed">
                                                <Grid Margin="0,0,0,10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="120"/>
                                                        <ColumnDefinition Width="80"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <DatePicker x:Name="DpTodoDate" Grid.Column="0" Margin="0,0,5,0" Foreground="{StaticResource TextBrush}"/>
                                                    <TextBox x:Name="TxtTodoTime" Grid.Column="1" Text="12:00" Margin="0,0,5,0" FontFamily="Cascadia Mono"/>
                                                    <TextBox x:Name="TxtTodoContent" Grid.Column="2" Margin="0,0,5,0"/>
                                                    <Button Grid.Column="3" Content="+" Click="BtnAddTodo_Click" Width="30"/>
                                                </Grid>

                                                <ItemsControl x:Name="ListTodo">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="{StaticResource CardAltBrush}" BorderBrush="{StaticResource StrokeBrush}" BorderThickness="1" CornerRadius="6" Margin="0,0,0,6" Padding="10,8">
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" Text="{Binding ReminderTime, StringFormat='MM/dd HH:mm'}" Foreground="{StaticResource AccentBrush}" FontSize="12" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Content}" Foreground="{StaticResource TextBrush}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                                    <Button Grid.Column="2" Content="×" Click="BtnDeleteTodo_Click" Tag="{Binding}" Background="Transparent" BorderThickness="0" Foreground="#D9534F" Padding="5,0"/>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Grid>
</Window>
